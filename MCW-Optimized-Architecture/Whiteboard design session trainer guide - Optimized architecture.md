![](images/HeaderPic.png "Microsoft Cloud Workshops")

# Optimized architecture

## Whiteboard design session trainer guide

## March 2018

Information in this document, including URL and other Internet Web site references, is subject to change without notice. Unless otherwise noted, the example companies, organizations, products, domain names, e-mail addresses, logos, people, places, and events depicted herein are fictitious, and no association with any real company, organization, product, domain name, e-mail address, logo, person, place or event is intended or should be inferred. Complying with all applicable copyright laws is the responsibility of the user. Without limiting the rights under copyright, no part of this document may be reproduced, stored in or introduced into a retrieval system, or transmitted in any form or by any means (electronic, mechanical, photocopying, recording, or otherwise), or for any purpose, without the express written permission of Microsoft Corporation.

Microsoft may have patents, patent applications, trademarks, copyrights, or other intellectual property rights covering subject matter in this document. Except as expressly provided in any written license agreement from Microsoft, the furnishing of this document does not give you any license to these patents, trademarks, copyrights, or other intellectual property.

The names of manufacturers, products, or URLs are provided for informational purposes only and Microsoft makes no representations and warranties, either expressed, implied, or statutory, regarding these manufacturers or the use of the products with any Microsoft technologies. The inclusion of a manufacturer or product does not imply endorsement of Microsoft of the manufacturer or product. Links may be provided to third party sites. Such sites are not under the control of Microsoft and Microsoft is not responsible for the contents of any linked site or any link contained in a linked site, or any changes or updates to such sites. Microsoft is not responsible for webcasting or any other form of transmission received from any linked site. Microsoft is providing these links to you only as a convenience, and the inclusion of any link does not imply endorsement of Microsoft of the site or the products contained therein.
© 2018 Microsoft Corporation. All rights reserved.

Microsoft and the trademarks listed at https://www.microsoft.com/en-us/legal/intellectualproperty/Trademarks/Usage/General.aspx are trademarks of the Microsoft group of companies. All other trademarks are property of their respective owners.


## Contents

-   **[Trainer information](#trainer-information)**
    -   [Role of the trainer](#role-of-the-trainer)
        -   [Whiteboard design session flow](#whiteboard-design-session-flow)
        -   [Before the whiteboard design session: How to prepare](#before-the-whiteboard-design-session-how-to-prepare)
        -   [During the whiteboard design session: Tips for an effective whiteboard design session](#during-the-whiteboard-design-session-tips-for-an-effective-whiteboard-design-session)
-   **[Optimized architecture whiteboard design session student guide](#optimized-architecture-whiteboard-design-session-student-guide)**
    -   [Abstract and learning objectives ](#abstract-and-learning-objectives)
    -   [Step 1: Review the customer case study](#step-1-review-the-customer-case-study)
        -   [Facilitator/subject matter expert (SME) presentation of customer case study](#facilitatorsubject-matter-expert-sme-presentation-of-customer-case-study)
        -   [Customer situation](#customer-situation)
        -   [Customer needs](#customer-needs)
        -   [Customer objections](#customer-objections)
        -   [Infographic for common scenarios](#infographic-for-common-scenarios)
    -   [Step 2: Design a proof of concept solution](#step-2-design-a-proof-of-concept-solution)
    -   [Step 3: Present the solution](#step-3-present-the-solution)
    -   [Wrap-up](#wrap-up)
    -   [Additional references](#additional-references)
-   **[Optimized architecture whiteboard design session trainer guide](#optimized-architecture-whiteboard-design-session-trainer-guide)**
    -   [Step 1: Review the customer case study](#step-1-review-the-customer-case-study-1)
    -   [Step 2: Design a proof of concept solution](#step-2-design-a-proof-of-concept-solution-1)
    -   [Step 3: Present the solution](#step-3-present-the-solution-1)
    -   [Wrap-up](#wrap-up-1)
    -   [Preferred target audience](#preferred-target-audience)
    -   [Preferred solution](#preferred-solution)
        -   [Phase 1](#phase-1)
        -   [Phase 2](#phase-2)
    -   [Customer quote (to be read back to the attendees at the end)](#customer-quote-to-be-read-back-to-the-attendees-at-the-end)
        
## Trainer information

Thank you for taking time to support the whiteboard design sessions as a
trainer!

## Role of the trainer

An amazing trainer:

-   Creates a safe environment in which learning can take place.

-   Stimulates the participant's thinking.

-   Involves the participant in the learning process.

-   Manages the learning process (on time, on topic, and adjusting to
    benefit participants).

-   Ensures individual participant accountability.

-   Ties it all together for the participant.

-   Provides insight and experience to the learning process.

-   Effectively leads the whiteboard design session discussion.

-   Monitors quality and appropriateness of participant deliverables.

-   Effectively leads the feedback process.

#### Whiteboard design session flow 

Each whiteboard design session uses the following flow:


## Step 1: Review the customer case study 

**Outcome**

Analyze your customer’s needs.

Time frame: 15 minutes 

Directions: With all participants in the session, the facilitator/SME presents an overview of the customer case study along with technical tips. 

1.  Meet your table participants and trainer.

2.  Read all the directions for Steps 1--3 in the student guide.

3.  As a table team, review the following customer case study.


**Step 2: Design a proof of concept solution (60 minutes)**

Outcome: Prepare to present a solution for your target customer audience

-   Determine your target customer audience

-   Determine customer's business needs to address your solution

-   Design and diagram your solution

-   Prepare to present your solution

**Step 3: Present the solution (30 minutes)**

Outcome: Present solution to your customer

-   Present solution

-   Respond to customer objections

-   Receive feedback

**Wrap-up (15 minutes)**

-   Review preferred solution

#### Before the whiteboard design session: How to prepare

Before conducting your first whiteboard design session:

-   Read the Student guide (including the case study) and Trainer guide

-   Become familiar with all key points and activities.

-   Plan the point you want to stress, which questions you want to
    drive, transitions, and be ready to answer questions.

-   Prior to the whiteboard design session, discuss the case study to
    pick up more ideas.

-   Make notes for later.

#### During the whiteboard design session: Tips for an effective whiteboard design session

**Refer to the Trainer guide** to stay on track and observe the timings.

**Do not expect to memorize every detail** of the whiteboard design
session.

When participants are doing activities, you can **look ahead to refresh
your memory**.

-   **Adjust activity and whiteboard design session pace** as needed to
    allow time for presenting, feedback, and sharing.

-   **Add examples, points, and stories** from your own experience.
    Think about stories you can share that help you make your points
    clearly and effectively.

-   **Consider creating a "parking lot"** to record issues or questions
    raised that are outside the scope of the whiteboard design session
    or can be answered later. Decide how you will address these issues,
    so you can acknowledge them without being derailed by them.

***Have fun**! Encourage participants to have fun and share!*

**Involve your participants.** Talk and share your knowledge but always
involve your participants, even while you are the one speaking.

**Ask questions** and get them to share to fully involve your group in
the learning process.

**Ask first**, whenever possible. Before launching into a topic, learn
your audience's opinions about it and experiences with it. Asking first
enables you to assess their level of knowledge and experience, and
leaves them more open to what you are presenting.

**Wait for responses**. If you ask a question such as, "What is your
experience with (fill in the blank)?" then wait. Do not be afraid of a
little silence. If you leap into the silence, your participants will
feel you are not serious about involving them and will become passive.
Give participants a chance to think, and if no one answers, patiently
ask again. You will usually get a response.

#  Optimized architecture whiteboard design session student guide

## Abstract and learning objectives 

In this workshop, you will learn how to optimize a lift and shift style
IaaS architecture in Azure to improve cost savings. You will also
compare IaaS and PaaS hosting options to save cost even further using
Azure App Service. Additionally, students will learn to improve
resiliency and high availability through multi-region deployment.

Attendees will learn how to:

-   Optimize Azure IaaS for cost savings

-   Migrate an Azure IaaS optimized

-   Compare cost between Azure IaaS versus Azure PaaS

-   Setup SQL Database geo-replication

-   Configure multi-region deployment


## Step 1: Review the customer case study 

**Outcome**

Analyze your customer’s needs.

Timeframe: 15 minutes 

Directions: With all participants in the session, the facilitator/SME presents an overview of the customer case study along with technical tips. 

1.  Meet your table participants and trainer.

2.  Read all the directions for Steps 1--3 in the student guide.

3.  As a table team, review the following customer case study.


#### Customer situation

Contoso Financial Inc. is one of the fastest
growing financial organizations in the United States. With its corporate
headquarters in Chicago, IL, the company has grown to over 1,000
employees. Most employees work from one of the regional offices
strategically located in all the major United States cities. However,
many of the employees work remotely either daily or even after hours.

Contoso has recently completed a migration to shift most its enterprise
data center footprint to the cloud. "The cloud is the future, and as
such, it is essential for us to proactively adopt the cloud before our
competitors to remain innovative and as competitive as possible," says
Emma Lowton, Chief Technology Officer. "Unfortunately, due to our
limited expertise in cloud computing, I have grown concerned that our
Azure spending is much higher than it should be."

The migration process performed by Contoso used the "Lift and shift"
method to move their existing workloads into Microsoft Azure. Their
current Azure usage is dependent on the Infrastructure as a Service
(IaaS) services in addition to the adoption of Azure Active Directory
(AD) and Office 365. So far, they have not used the Platform as a
Service (PaaS) services very much except for Azure Storage and Azure
Service Bus Queue, which replaced MSMQ.

Last year, Contoso completed the acquisition of the European based
Lucerne Ltd. With the acquisition complete, a deadline was set to begin
migrating all Lucerne employees to the Contoso systems within 18 months.
The Chief Executive Office, Jay Calvin's biggest concern with the
existing architecture is, "With concerns about spending too much, I am
very concerned we will not be able to stay competitive, as we onboard
the Lucerne employees over to use Contoso systems."

The company has over 120 workloads migrated to running in Microsoft
Azure. Only a small number of these are considered mission critical.
Ultimately, all the workloads will need to be optimized for reduced
Azure spending without compromising system resiliency and reliability.
The Contoso's IT Operations team has identified a single mission
critical workload that consists of a 3-tier web application with a SQL
Server database. After optimization has been proven with this single
application, plans will be laid to perform similar cost optimizations
across their entire cloud footprint.

It has already been identified that the existing Azure architecture has
been overprovisioned for the workload. The existing architecture within
Azure needs to be modified to match more closely with the workload
demand and use some of the cloud features of Azure that allow for
greater cost savings. In addition to reducing cost, the architecture
also needs to be optimized to be able to handle Contoso's future growth,
even after Lucerne employees have been onboarded.

**Existing architecture**

Percy Bowman is the Director of IT Operations and manages the team
responsible for maintaining the enterprise systems. Percy is concerned
that "the current architecture is much too difficult to maintain over
time with all of the manual operations necessary, especially as the
company continues to grow and expand into Europe." The existing
architecture is made up of multiple virtual machines that need to be
fully managed and maintained by Contoso today. As the company continues
to grow, the system needs to be able to scale more easily, as adding
more VMs over time will eventually lead to prohibitive costs. It is the
primary reason the Contoso enterprise workloads were migrated into the
cloud in the first place.

The system is broken out into three tiers (Front-end Web App, Back-end
Web API, Back-end Processing) and a Microsoft SQL Server database
server. The VM count for the different tiers remains the same as when
the system was hosted on-premises since they performed a straight "Lift
and shift" to move into Azure. The Web App and Web API tiers are made up
of three VMs each. Both the Web App and Web API tiers use an Azure Load
Balancer to distribute traffic across the redundant VMs. The Back-end
Processing tier is made up of two VMs for redundancy, with the
additional benefit of meeting the SLA uptime guarantee.

The Front-end Web App and Back-end Web API tiers are hosted on Windows
Server 2012 R2 using Microsoft Internet Information Services (IIS). The
server-side application code for the Front-end Web App tier is written
in C\# using ASP.NET MVC 5. The application code for the Back-end Web
API tier is written in C\# using ASP.NET Web API and uses Entity
Framework to communicate with the SQL Server database.

The Back-end Processing tier is hosted on Windows Server 2012 R2 with
the application code written as a C\# Console Application. The Back-end
Processing tier receives messages of work to be done from the Back-end
Web API tier using an Azure Service Bus Queue.

The database server is somewhat of a problem area with the current
architecture. During the migration, the productionpPilot environment was
setup in the Azure West US region. When the final production environment
was built out, it was determined the Azure North Central US region would
be used to better serve users and be located geographically closer to
the corporate headquarters. The database server is running Microsoft SQL
Server 2014, and is hosted on a single VM. So far, the overall necessary
performance demand has been met, but the database server lacks
redundancy. The way it is hosted was only meant to be temporary when
going live into full production. However, in the rush to put out other
production fires at the time of "Go Live", the Production Pilot VM for
the database server stayed in place. According to Percy Bowman,
Directory of IT Operations, "the database server has not failed us yet,
but we know this setup is less than ideal. Although, we do keep backups
in the event of a failure."

![Diagram of the previously described Existing
architecture.](images/Whiteboarddesignsessiontrainerguide-Optimizedarchitectureimages/media/image2.png "Existing architecture diagram")

**Existing virtual machine utilization**

The Contoso IT Operations team decided to standardize on the "Standard
D3" VM instance size (4 cores, 14GB RAM) for the Front-end and Back-end
tiers using Standard storage. The SQL Server database server VM needs
more resources so it is configured to use the "Standard GS4" VM instance
size (16 cores, 224GB RAM).

Contoso IT Operations team does use some third-party tools to aggregate
server metrics for simplified reporting and monitoring processes.
However, the primary method they used to gather the CPU and RAM
utilization of the specific workload to target was to sign in to the
Azure Portal and access Azure's VM monitoring within the Virtual Machine
blade. They gathered both the "CPU percentage" and "Memory usage"
statistics to get average CPU and RAM utilization percentages for the
virtual machines.

The average CPU and RAM usage of the servers during normal business
hours (8AM -- 5PM, Monday through Friday) and the estimated cost per VM
is as follows:

![In this Standard D3 pricing tier, the first row is Front-End Web App
Tier, which offers CPU of 36 percent and RAM of 46 percent, or CPU of 38
percent or RAM of 44 percent. The second row is the Back-End Web App
Tier, which has CPU of 58 percent and RAM of 34 percent, or CPU of 56
percent or RAM of 31 percent. The third row is Back-end processing tier,
which is CPU of 49 percent, and RAM of 25 percent. The bottom row,
Database Server SQL Database: Preium P4, has no CPU or RAM
information.](images/Whiteboarddesignsessiontrainerguide-Optimizedarchitectureimages/media/image3.png "Standard D3 pricing tier")

**Database usage analysis**

One of the Database Administrators at Contoso, Naina Dhyani, has
completed some additional performance profiling to help determine how to
optimize the SQL Server VM. Using the production server, Naina captured
performance metrics and used the Azure SQL Database DTU Calculator to
determine the estimated DTU (data through-put unit) requirements of the
SQL Server VM. According to Naina, "It gave me the result that our
database requires about 400 DTUs. I am really not sure what a DTU is,
but I know Azure SQL Databases use that for billing."


#### Customer needs 

1.  Design a two-phase approach to the process of migrating Azure
    resources towards the goal of optimized spending.

2.  Fix the SQL Server database hosting to be more robust, reliable, and
    enterprise-grade.

3.  Automatic scaling needs to be implemented to reduce the manual
    process involved.

4.  Identify the appropriate method to use for scaling out the different
    application tiers to meet increases in load.

5.  Identify the appropriate VM sizes for each application tier.

6.  Validate the appropriate Azure Regions are used for hosting and
    create a plan to migrate any necessary resources to a different
    region.

7.  Identify the PaaS services to use, and the App Service Plans, and
    create a migration plan.

8.  Identify a strategy to reduce server maintenance as the system is
    scaled out to meet increased load.

9.  The migration steps should not require any changes to application
    code.


#### Customer objections 

1.  Reducing the overall spending on Azure is great, but how will we
    ensure costs remain optimized?

2.  If we drastically change the overall architecture, will we be able
    to migrate it without taking it down for a week?

3.  Our operations team is new to the cloud and Microsoft Azure. While
    we are comfortable using the IaaS services, we are concerned that
    PaaS services will be difficult to monitor and maintain when mixed
    with IaaS services in our overall environment.

4.  We are concerned that the system performance for the European users
    will not be as good as it needs to be. In the past, we have had
    employees work while traveling and the system was slow for them.

5.  The VM sizes currently used appear to be more than we need, but how
    can we determine what the appropriate sizes should be?

6.  We have already purchased SQL Server and other product licenses. I
    am worried the savings from optimizing spending using Azure PaaS
    services will not be significant to be worth it.


#### Infographic for common scenarios

###### Azure virtual network with VMs and load balancers

![Azure infrastructure showing front end subnet and back end
subnet.](images/Whiteboarddesignsessiontrainerguide-Optimizedarchitectureimages/media/image4.png "Azure infrastructure")

###### 3-tier Azure Web App architecture with message queue

![The 3-tier Azure Web App architecture with message queue is split into
two sections: Internet (with three user icons), and Azure, with
everything else. The users on the internet side go through a Traffic
Manager to the Azure App Service, with Web App Instances and Autoscale.
This points to the Azure App Service / Back-end Tier, with Web API
Instances and Autoscale. This points to Azure SQL Databases, and also
shares a bi-directional arrow with Message Queue (Storage Queue or
Service Bus Queue.) The Message Queue points to Web Job Instances with
AutoScale, which completes the circle by pointing back to Web API
Instances.](images/Whiteboarddesignsessiontrainerguide-Optimizedarchitectureimages/media/image5.png "3-tier Azure Web App architecture with message queue")

## Step 2: Design a proof of concept solution

**Outcome**

Design a solution and prepare to present the solution to the target
customer audience in a 15-minute chalk-talk format.

Time frame: 60 minutes

**Business needs**

Directions: With all participants at your table, answer the following
questions, and list the answers on a flip chart.

1.  Who should you present this solution to? Who is your target customer
    audience? Who are the decision makers?

2.  What customer business needs do you need to address with your
    solution?

**Design **

Directions: With all participants at your table, respond to the
following questions on a flip chart.

**Two-phase solution**

**Phase 1**

Design the changes to the existing solution architecture using IaaS
(Infrastructure as a Service) services to reduce and optimize the cost
of Azure. Included in this phase should be a solution to make the SQL
Server more robust. Identify the steps necessary to modify the
architecture and what needs to be demonstrated to stakeholders.

-   Database server

    -   Which Azure SQL Database hosting solution would you recommend?

    -   What is the recommended Azure Region to use for the SQL
        Database?

    -   What is the recommended Azure SQL Database pricing tier?

-   Cost optimization

    -   What VM scaling solution is recommended?

    -   How do you determine the appropriate VM size for each tier?

    -   What are the recommended VM size and count to use for each
        application tier?

    -   What is the calculated cost and overall savings gained from this
        design?

    -   How do these optimizations reduce the total cost of server
        maintenance and operation?

-   Migration

    -   What order or steps would you recommend taking when changing the
        architecture?

-   Diagram the solution

**Phase 2**

Outline the changes necessary to transform the Phase 1 architecture
design over to further optimizing Azure spend by using the Azure PaaS
(Platform as a Service) services that fit the solution. Identify the
steps necessary and what needs to be demonstrated to stakeholders to
convince them of the viability of the final solution architecture
design.

-   Cost optimization

    -   What services would you recommend to further optimize the
        solution for lower total cost?

    -   How do you determine the appropriate App Service Plan to use?

    -   What are the recommended App Service Plans to use for each
        application tier?

    -   What is the calculated cost and overall savings gained from this
        design?

    -   How do these optimizations reduce the total cost of server
        maintenance and operation?

-   Scalability

    -   What service should be used to ensure expected application
        performance is maintained when onboarding Lucerne employees?

-   Migration

    -   What order or steps would you recommend taking when changing the
        architecture?

-   Diagram the solution

**Prepare**

Directions: With all participants at your table:

1.  Identify any customer needs that are not addressed with the proposed solution.

2.  Identify the benefits of your solution.

3.  Determine how you will respond to the customer's objections.

4. Prepare a 15-minute chalk-talk style presentation to the customer.

## Step 3: Present the solution

**Outcome**

Present a solution to the target customer audience in a 15-minute
chalk-talk format.

**Presentation**

Time frame: 30 minutes

**Directions**

1.  Pair with another table.

2.  One table is the Microsoft team and the other table is the customer.

3.  The Microsoft team presents their proposed solution to the customer.

4.  The customer makes one of the objections from the list of
    objections.

5.  The Microsoft team responds to the objection.

6.  The customer team gives feedback to the Microsoft team.

7.  Tables switch roles and repeat Steps 2--6.

##  Wrap-up 

Time frame: 15 minutes

-   Tables reconvene with the larger group to hear a SME share the preferred solution for the case study.

##  Additional references


|    |            |
|----------|:-------------:|
| Windows Virtual Machines documentation | <https://azure.microsoft.com/en-us/documentation/services/virtual-machines/windows/> |
| Azure Reserved VM instances| <https://azure.microsoft.com/en-us/pricing/reserved-vm-instances/> |
| Virtual Machine Pricing | <https://azure.microsoft.com/en-us/pricing/details/virtual-machines/#Windows> |
| Virtual Machine Scale Sets pricing | <https://azure.microsoft.com/en-us/pricing/details/virtual-machine-scale-sets/> |
| Virtual Network overview | <https://azure.microsoft.com/en-us/documentation/articles/virtual-networks-overview/>|
| Network security group (NSG) overview | <https://azure.microsoft.com/en-us/documentation/articles/virtual-networks-nsg>|
| Load Balancer overview | <https://azure.microsoft.com/en-us/documentation/articles/load-balancer-overview/>|
| Traffic Manager overview| <https://azure.microsoft.com/en-us/documentation/articles/traffic-manager-overview/>|
| Web apps overview | <https://azure.microsoft.com/en-us/documentation/articles/app-service-web-overview/>|
| Web jobs overview | <https://azure.microsoft.com/en-us/documentation/articles/app-service-webjobs-readme/>|
| Scale a Web App | <https://azure.microsoft.com/en-us/documentation/articles/web-sites-scale/> |
| Introduction to Azure SQL database | <https://azure.microsoft.com/en-us/documentation/articles/sql-database-technical-overview/> |
| Azure SQL Database benchmark overview | <https://azure.microsoft.com/en-us/documentation/articles/sql-database-benchmark-overview/> |
| Azure SQL Database pricing | <https://azure.microsoft.com/en-us/pricing/details/sql-database/> |
| Azure Channel Pricing calculator | <https://azure.microsoft.com/en-us/pricing/calculator/channel/> |
| Azure Pricing Calculator | <https://azure.microsoft.com/en-us/pricing/calculator>|
| Azure SQL database DTU calculator| <http://dtucalculator.azurewebsites.net/> |

	

# Optimized architecture whiteboard design session trainer guide

## Step 1: Review the customer case study

-   Check in with your table participants to introduce yourself as the trainer.

-   Ask, "What questions do you have about the customer case study?"

-   Briefly review the steps and time frames of the whiteboard design session.

-   Ready, set, go! Let the table participants begin.

## Step 2: Design a proof of concept solution

-   Check in with your tables to ensure they are transitioning from step
    to step on time.

-   Provide some feedback on their responses to the business needs and
    design.

    -   Try asking questions first that will lead the participants to
        discover the answers on their own.

-   Provide feedback for their responses to the customer's objections.

    -   Try asking questions first that will lead the participants to
        discover the answers on their own.

## Step 3: Present the solution

-   Determine which table will be paired with your table before Step 3
    begins.

-   For the first round, assign one table as the Microsoft team and the
    other table as the customer.

-   Have the Microsoft team present their solution to the customer team.

    -   Have the customer team provide one objection for the Microsoft
        team to respond to.

    -   The presentation and objections should be no longer than
        10-minutes.

-   Have participants on the customer team give feedback to the
    Microsoft team.

    -   The feedback should be no longer than 5 minutes.

    -   If needed, the trainer may also provide feedback.

## Wrap-up

-   Have the table participants reconvene with the larger session group
    to hear a SME share the following preferred solution.

##  Preferred target audience

-   Jay Calvin, Chief Executive Officer

-   Percy Bowman, Director of IT Operations

## Preferred solution

**Phase 1 design**

The Phase 1 design remains centered on the use of Azure Infrastructure
(IaaS) services to optimize the spending of the existing architecture.
The Phase 1 design solution involves the following technologies and
modifications:

-   Implementing VM Scale Sets for the Font-end Web App and Back-end Web
    API application tiers.

-   Resizing the VM Sizes used for each of the application tiers should
    be done to eliminate any over provisioning. Over provisioning wastes
    money by paying for resources that are not necessary.

    -   Resize the Front-end Web App Tier VMs to the *Standard F4* VM
        size.

    -   Resize the Back-end Web API Tier VMs to the *Standard F4* VM
        size.

    -   Resize the Back-end Processing Tier VMs to the *Standard F2* VM
        size.

-   Migrating the SQL Database server to the *North Central US* region
    (same region the rest of the application resides.)

-   Migrating the SQL Database VM to Azure SQL Database using the
    *Premium P4* pricing tier.

-   Configure SQL Database Active Geo-Replication for added resiliency

![Diagram of the previously described Preferred solution Phase
1.](images/Whiteboarddesignsessiontrainerguide-Optimizedarchitectureimages/media/image6.png "Preferred solution Phase 1 diagram")

**Phase 2 design**

The Phase 2 design switches focus to using Azure Platform (PaaS)
services as much as possible to further reduce overall spending.

-   Migrating the Front-end Web App tier to use Azure Web Apps with the
    *Standard S3* App Service Plan

-   Migrating the Back-end Web API tier to use Azure Web Apps with the
    *Standard S3* App Service Plan

-   Migrating the Back-end Processing tier to use Azure Web Jobs with
    the *Standard S3* App Service Plan

-   Implementing Autoscale for all three application tiers (Front-end
    Web App, Back-end Web API, and Back-end Processing)

-   Implementing Traffic Manager in Geographic mode instead of the
    External Load Balancer

![Diagram of the previously described Preferred solution Phase
2.](images/Whiteboarddesignsessiontrainerguide-Optimizedarchitectureimages/media/image7.png "Phase 2 preferred solution diagram")

**Total cost savings**

There are many services involved in this architecture that incur Azure
costs. The following table outlines the estimated spending and total
savings for the Phase 1 and Phase 2 designs in regard to only the VMs,
App Service Plans, and SQL Database:

                                         Monthly Cost   Total Monthly Savings   Total Yearly Savings
  -------------------------------------- -------------- ----------------------- ----------------------
  Existing Solution                      \$6,902        \-                      \-
  Phase 1 Design                         \$3,510        \$3,392                 \$40,704
  Phase 1 Design w/ Reserved Instances   \$2,980        \$3,922                 \$47,064
  Phase 2 Design                         \$3,582        \$3,320                 \$39,840

#### Phase 1

**Database server**

**Task:** Which Azure SQL Database hosting solution would you recommend?

**Answer:** Azure SQL Database: The existing architecture is relying on
a single VM to host the SQL Server database server. Implementing Azure
SQL Database with Active Geo-Replication will deliver predictable
performance, scalability with no downtime, business continuity, and data
protection---all with near-zero administration.

Note: The *Standard GS4* VM size the existing architecture is using in
the West US region is not available in the *North Central US* region.

**Task:** What is the recommended Azure Region to use for the SQL
Database?

**Answer:** North Central US: Transferring data between non-paired Azure
regions incurs Egress/Outbound data transfer charges. Placing the
database in the same Azure region as the rest of the application will
eliminate these charges.

**Task:** What is the recommended Azure SQL Database pricing tier?

**Answer:** Premium P4: According to the estimated DTU requirements of
the SQL Server database server it is the appropriate pricing tier.

**Cost Optimization**

**Task:** What VM scaling solution is recommended?

**Answer:** VM Scale Sets: Implementing VM Scale Sets allows for the VMs
supporting the workloads to be scaled in/out automatically.

**Task:** How do you determine the appropriate VM size for each tier?

**Answer:** Compare the VM CPU/RAM utilization of the existing
architecture VM sizes to the list of available VM sizes within the Azure
North Central US region and determine which VM sizes better fit the VM
CPU/RAM utilization.

**Task:** What are the recommended VM size and count to use for each
application tier?

**Answer:**\
Front-end Web App VMs: Standard F4 -- three instances\
Back-end Web API VMs: Standard F4 -- two instances\
Back-end Processing VMs: Standard F2 -- two instances\
SQL Server VM: None -- it is migrated to Azure SQL Database service

**Task:** What is the calculated cost and overall savings gained from
this design?

**Answer:**

The total estimated cost of the VMs with Reserved Instances and Azure
SQL pricing tier is \$2,980 (as opposed to \$3,510 without reserved
instances). This number does not consider the implementation of VM Scale
Sets, so it is possible the actual cost will be somewhat lower. The
calculated annual savings moving from the Existing Architecture to the
Phase 1 design is \$47,064.

![Screenshot of the Application Tier pricing, with the total annual
savings, as previously
described.](images/Whiteboarddesignsessiontrainerguide-Optimizedarchitectureimages/media/image8.png "Pricing by Application Tier")

Below are the prices for the different VM and SQL Database instance
tiers:

-   VM - Standard F4 = \$192 /mo.

-   VM - Standard F2 = \$95 /mo.

-   SQL Database - Premium P4 = \$1,830 /mo.

**Task:** How do these optimizations reduce the total cost of server
maintenance and operation?

**Answer:**

1.  Eliminate overprovisioning: It eliminates the cost of paying for
    extra resources that are not being used.

2.  Lower manual operations: Implementing VM Scale Sets eliminates the
    need to perform any manual operations to scale in/out the VMs to
    meet application load.

**Migration**

**Task:** What order or steps would you recommend taking when changing
the architecture?

**Answer:** It is recommended to modify the architecture for each of the
Application Tiers individually to reduce the risk of application
downtime during the migration process. Here is a sample outline of
recommended steps:

1.  Migrate SQL Server database from VM into Azure SQL Database within
    Azure North Central US region

    a.  Determine appropriate Azure SQL Database pricing tier

    b.  Setup Azure SQL Database with cloned database

    c.  Switch application over to use new database

    d.  Remove old SQL Server VM

2.  Setup geo-replication of the Azure SQL database to another Azure
    region

3.  Migrate Web API tier to use VM Scale Set instead of individual VMs

    a.  Determine appropriate VM size

    b.  Setup new VM Scale Set

    c.  Switch over Load Balancer to new VMs

    d.  Remove old VMs

4.  Migrate Web App tier to use VM Scale Set instead of individual VMs

    a.  Determine appropriate VM size

    b.  Setup new VM Scale Set

    c.  Switch over Load Balancer to new VMs

    d.  Remove old VMs

#### Phase 2

**Cost optimization**

**Task:** What services would you recommend to further optimize the
solution for lower total cost?

**Answer:** Traffic Manager and App Service (Web Apps and Web Jobs)

**Task:** How do you determine the appropriate App Service Plan to use?

**Answer:** Compare the VM CPU/RAM utilization of the existing
architecture VM sizes to the list of App Service Plan tiers within the
Azure North Central US region and determine which App Service Plan
better fits the specific Application Tier workload. It also needs to
consider the Instance Count to factor in the setup of Multiple VMs
appropriately.

**Task:** What are the recommended App Service Plans to use for each
application tier?

**Answer:\
**Front-end Web App Tier: Standard S3 w/ three instances\
Back-end Web API Tier: Standard S3 w/ three instances\
Back-end Processing Tier: Standard S3 w/ one instance\
SQL Database: No change from Phase 1 using Azure SQL Database service

**Task:** What is the calculated cost and overall savings gained from
this design?

**Answer:** The total estimated cost of the App Service Plans and Azure
SQL pricing tier is \$3,582. This number does not consider the
implementation of Azure Autoscale, so it is possible the actual cost
will be somewhat lower. The calculated annual savings moving from the
existing architecture to the Phase 2 design is \$39,840.

![Screenshot of the Application Tier pricing, with the total annual
savings, as previously
described.](images/Whiteboarddesignsessiontrainerguide-Optimizedarchitectureimages/media/image9.png "Pricing by Application Tier")

Below are the prices for the different VM and SQL database instance
tiers:

-   App Service Plan - Standard S3 = \$292 /mo.

-   SQL Database - Premium P4 = \$1,830 /mo.

**Task:** How do these optimizations reduce the total cost of server
maintenance and operation?

**Answer:** These are the two factors with this design that reduce the
total cost:

1.  Lower Maintenance: With implementing Azure App Service PaaS service
    there is no operating system or virtual machines to manage. It
    reduces the cost and workload on IT Operations staff.

2.  PaaS: The PaaS services in Azure offer lower pricing for similar
    server resources.

**Scalability**

**Task:** What service should be used to ensure expected application
performance is maintained when onboarding Lucerne employees?

**Answer:** Traffic Manager in Geographic mode with additional Web App
in a European Azure region: Traffic Manager will ensure that the
application is served up from the Azure region closest to the user. The
additional Web App in a European Azure region will also help isolate the
US and European user workload to different servers.

**Migration**

**Task:** What order or steps would you recommend taking when changing
the architecture?

**Answer:** It is recommended to modify the architecture for each of the
application tiers individually to reduce the risk of application
downtime during the migration process. Here is a sample outline of
recommended steps:

1.  Migrate Front-end Web App tier over to Azure Web Apps with Azure
    Autoscale

    a.  Determine the appropriate App Service Plan

    b.  Setup the Azure Web App

    c.  Configure Autoscale

2.  Replace the Internet Load Balancer with Traffic Manager in
    Geographic mode pointed to the Web App

    a.  Create Traffic Manager

    b.  Set it up with Web App

    c.  Swap out Load Balancer endpoint to use Traffic Manager

    d.  Remove old Internet Load Balancer

3.  Migrate Back-end Processing over to Azure Web Jobs with Azure
    Autoscale

    a.  Determine the appropriate App Service Plan

    b.  Setup the Azure Web Jobs

    c.  Configure Autoscale

    d.  Remove old VM Scale Set

4.  Migrate Back-end Web API over to Azure Web Apps with Azure Autoscale

    a.  Determine the appropriate App Service Plan

    b.  Setup the Azure Web App

    c.  Configure Autoscale

    d.  Point Front-end Web App and Back-end Processing application
        tiers to new Azure Web App

    e.  Remove old VM Scale Set and Internal Load Balancer

5.  Setup Front-end Web App duplicate in Azure North Europe Region

    a.  Create App Service Plan in Azure North Europe Region

    b.  Setup the Azure Web App

    c.  Configure Autoscale

    d.  Add new region to Traffic Manager


## Checklist of preferred objection handling

1.  Reducing the overall spending on Azure is great, but how will we
    ensure costs remain optimized?

    **Potential answer\
    **The use of automation through Azure services like Autoscale will
    allow the specific pricing tiers and instance counts to be
    controlled in a manner that is immune to the user errors of manual
    processes. Every time a VM instance is scaled out/in it will be done
    the exact same way every time. Once the optimized pricing tiers and
    scaling configurations are set, they will remain that way until
    deliberately changes.

    Additionally, third-party tools like Cloud Cruiser
    (<http://cloudcruiser.com>) and Hanu Insights
    (<http://hanuinsights.com>) can be used to monitor and forecast
    Azure spending over time.

2.  If we drastically change the overall architecture, will we be able
    to migrate it without taking it down for a week?

    > **Potential answer**\
    > Overall downtime can be minimized drastically with careful planning
    > and a step-by-step phased approach to the migration. The basic idea is
    > to migrate a single component of the workload at a time to minimize
    > the risk of bringing down other components.

3.  Our operations team is new to the cloud and Microsoft Azure. While
    we are comfortable using the IaaS services, we are concerned that
    PaaS services will be difficult to monitor and maintain when mixed
    with IaaS services in our overall environment.

    > **Potential answer**\
    > Certainly, there are things an operations team needs to learn when
    > adopting a technology, they are not very familiar with. Fortunately,
    > with the Azure PaaS services, such as Azure App Service, there will be
    > decrease in the amount of time and work necessary to maintain the
    > application workload running in Azure. It will give the operations
    > team more time to spend on other tasks.

4.  We are concerned that the system performance for the European users
    will not be as good as it needs to be. In the past we have had
    employees work while traveling and the system was slow for them.

    > **Potential answer**\
    > Implementing Traffic Manager in Geographic mode with a separate Web
    > App instance located in the North Europe Azure Region allocates
    > dedicated resources to handle load from the European users. It also
    > puts the application geographically closer to them, which reduces
    > network latency across the internet and will speed up load times.

5.  The VM sizes currently used appear to be more than we need, but how
    can we determine what the appropriate sizes should be?

    > **Potential answer**\
    > Determining the appropriate VM sizes can be done by comparing the
    > current utilization percentages of the VMs in the existing
    > architecture to the different VM size pricing tiers. This metric can
    > be used to determine VM sizes for the different application tiers
    > that more closely align with real workload demand.

6.  We have already purchased SQL Server and other product licenses. I
    am worried the savings from optimizing spending using Azure PaaS
    services will not be significant to be worth it.

    > **Potential answer**\
    > The reduces monthly spending on Azure services as well as the
    > reduced workload on IT Operations staff is not just a one-time
    > savings. It is a monthly savings that will be realized over the
    > coming months, and even years. In addition to these compounded
    > savings, the use of Azure PaaS services also completely eliminates
    > the need to purchase any future SQL Service upgrades.

## Customer quote (to be read back to the attendees at the end)

"We have realized some savings when we initially adopted Microsoft
Azure, but with these proposed changes we are not only staying
innovative; we are setting ourselves up to remain competitive on a
technology level for years to come."

--- Jay Calvin, Chief Executive Officer, Contoso Financial Inc.

